# Project Sync Workflow
# Automatically adds new issues to organization projects
#
# Synced from jbcom-control-center (always-sync)
# DO NOT EDIT - changes will be overwritten

name: Project Sync

on:
  issues:
    types: [opened, labeled]

permissions:
  issues: read

env:
  # Project IDs from jbcom organization
  INTEGRATION_PROJECT_ID: "PVT_kwHOAChyN84BJLOn"
  ROADMAP_PROJECT_ID: "PVT_kwHOAChyN84BKeDX"

jobs:
  add-to-project:
    name: Add to Projects
    runs-on: ubuntu-latest
    steps:
      - name: Get issue details
        id: issue
        run: |
          echo "number=${{ github.event.issue.number }}" >> $GITHUB_OUTPUT
          echo "title=${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
          
          # Determine project based on labels and title
          LABELS="${{ join(github.event.issue.labels.*.name, ',') }}"
          TITLE="${{ github.event.issue.title }}"
          
          ADD_INTEGRATION=false
          ADD_ROADMAP=false
          
          # EPICs go to Roadmap
          if [[ "$TITLE" == *"EPIC"* ]] || [[ "$LABELS" == *"epic"* ]]; then
            ADD_ROADMAP=true
          fi
          
          # Features go to Roadmap
          if [[ "$LABELS" == *"enhancement"* ]] || [[ "$TITLE" == "feat:"* ]]; then
            ADD_ROADMAP=true
          fi
          
          # Bugs go to Integration
          if [[ "$LABELS" == *"bug"* ]] || [[ "$TITLE" == "fix:"* ]]; then
            ADD_INTEGRATION=true
          fi
          
          # CI/infra go to Integration
          if [[ "$LABELS" == *"ci"* ]] || [[ "$LABELS" == *"infrastructure"* ]]; then
            ADD_INTEGRATION=true
          fi
          
          # Default to Integration
          if [[ "$ADD_INTEGRATION" == "false" ]] && [[ "$ADD_ROADMAP" == "false" ]]; then
            ADD_INTEGRATION=true
          fi
          
          echo "add_integration=$ADD_INTEGRATION" >> $GITHUB_OUTPUT
          echo "add_roadmap=$ADD_ROADMAP" >> $GITHUB_OUTPUT

      # actions/add-to-project v1.0.2
      - name: Add to Integration Project
        if: steps.issue.outputs.add_integration == 'true'
        uses: actions/add-to-project@244f685bbc3b7adfa8466e08b698b5577571133e
        with:
          project-url: https://github.com/orgs/jbcom/projects/2
          github-token: ${{ secrets.CI_GITHUB_TOKEN }}

      # actions/add-to-project v1.0.2
      - name: Add to Roadmap Project
        if: steps.issue.outputs.add_roadmap == 'true'
        uses: actions/add-to-project@244f685bbc3b7adfa8466e08b698b5577571133e
        with:
          project-url: https://github.com/orgs/jbcom/projects/8
          github-token: ${{ secrets.CI_GITHUB_TOKEN }}
